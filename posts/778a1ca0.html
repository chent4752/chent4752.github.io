<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Redis命令集合 | Chenkt🥝</title><meta name="keywords" content="redis"><meta name="author" content="Chenkt🥝"><meta name="copyright" content="Chenkt🥝"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="第二章 Redis 数据类型及操作 2.2 strings 类型及操作 2.2.1 set 123redis 127.0.0.1:6379&gt; set name HongWanOKredis 127.0.0.1:6379&gt; 2.2.2 setnx 设置 key 对应的值为 string 类型的 value。如果 key 已经存在，返回 0，nx 是 not exist 的意思 12345">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis命令集合">
<meta property="og:url" content="https://www.fomal.cc/posts/778a1ca0.html">
<meta property="og:site_name" content="Chenkt🥝">
<meta property="og:description" content="第二章 Redis 数据类型及操作 2.2 strings 类型及操作 2.2.1 set 123redis 127.0.0.1:6379&gt; set name HongWanOKredis 127.0.0.1:6379&gt; 2.2.2 setnx 设置 key 对应的值为 string 类型的 value。如果 key 已经存在，返回 0，nx 是 not exist 的意思 12345">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://source.fomal.cc/img/default_cover_14.webp">
<meta property="article:published_time" content="2022-04-28T00:58:41.000Z">
<meta property="article:modified_time" content="2024-10-13T14:03:43.121Z">
<meta property="article:author" content="Chenkt🥝">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://source.fomal.cc/img/default_cover_14.webp"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://www.fomal.cc/posts/778a1ca0"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redis命令集合',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-13 22:03:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Chenkt🥝" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/01/02/avatar.webp" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> 画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> 动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 旧时光</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> 唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> 恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Chenkt🥝</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> 画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> 动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 旧时光</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> 唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> 恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> 搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">Redis命令集合</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于 </span><time class="post-meta-date-created" datetime="2022-04-28T00:58:41.000Z" title="发表于 2022-04-28 08:58:41">2022-04-28</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-13T14:03:43.121Z" title="更新于 2024-10-13 22:03:43">2024-10-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">1w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>45分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Redis命令集合"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>第二章 Redis 数据类型及操作</h1>
<h2 id="2-2-strings-类型及操作">2.2 strings 类型及操作</h2>
<h3 id="2-2-1-set">2.2.1 set</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; set name HongWan</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-2-setnx">2.2.2 setnx</h3>
<p>设置 key 对应的值为 string 类型的 value。如果 key 已经存在，返回 0，nx 是 not exist 的意思</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;HongWan&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; setnx name HongWan_new</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;HongWan&quot;</span><br><span class="line">redis 127.0.0.1:6379</span><br></pre></td></tr></table></figure>
<h3 id="2-2-3-setex">2.2.3 setex</h3>
<p>设置 key 对应的值为 string 类型的 value，并指定此键值对应的有效期。<br>
例如我们添加一个 haircolor= red 的键值对，并指定它的有效期是 10 秒，可以这样做:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; setex haircolor 10 red</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; get haircolor</span><br><span class="line">&quot;red&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; get haircolor</span><br><span class="line">(null)</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>由于最后一次的调用是 10 秒以后了，所以取不到 haicolor 这个键对应的值。</p>
<h3 id="2-2-4-setrange">2.2.4 setrange</h3>
<p>设置指定 key 的 value 值的子字符串。<br>
例如我们希望将 HongWan 的 126 邮箱替换为 gmail 邮箱</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;setnx name 477606127@163.com</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;setrange name 10 qq.com</span><br><span class="line">&quot;17&quot;</span><br><span class="line">localRedis:0&gt;get name</span><br><span class="line">&quot;477606127@qq.comm&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-5-mset">2.2.5 mset</h3>
<p>一次设置多个 key 的值，成功返回 ok 表示所有的值都设置了，失败返回 0 表示没有任何值被设置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;mset name1 ckt name2 chenkt</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">localRedis:0&gt;get name1</span><br><span class="line">&quot;ckt&quot;</span><br><span class="line">localRedis:0&gt;get name2</span><br><span class="line">&quot;chenkt&quot;</span><br><span class="line">localRedis:0&gt;del name1 name2</span><br></pre></td></tr></table></figure>
<h3 id="2-2-6-msetnx">2.2.6 msetnx</h3>
<p>和上面setnx mset差不多只不过可以 multi 操作懒得写了</p>
<h3 id="2-2-7-get">2.2.7 get</h3>
<p>已经用过很多次了</p>
<h3 id="2-2-8-getset">2.2.8 getset</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;getset name chenkt1</span><br><span class="line">null</span><br><span class="line">localRedis:0&gt;set name chenkt1</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">localRedis:0&gt;get name</span><br><span class="line">&quot;chenkt1&quot;</span><br><span class="line">localRedis:0&gt;getset name chenkt!!!!!</span><br><span class="line">&quot;chenkt1&quot;</span><br><span class="line">localRedis:0&gt;get name</span><br><span class="line">&quot;chenkt!!!!!&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<p>key 不存在将返回null，存在name则打印并修改值</p>
<h3 id="2-2-9-getrange">2.2.9 getrange</h3>
<p>节选value字符串子串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;HongWan@126.com&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; getrange name 0 6</span><br><span class="line">&quot;HongWan&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">-1是右开始，和python差不多</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; getrange name -7 -1</span><br><span class="line">&quot;126.com&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; getrange name 7 100</span><br><span class="line">&quot;@126.com&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;超出maxlength默认最大下标</span><br></pre></td></tr></table></figure>
<h3 id="2-2-10-mget">2.2.10 mget</h3>
<p>多个get</p>
<h3 id="2-2-11-incr">2.2.11 incr</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;set age 20</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">localRedis:0&gt;incr age</span><br><span class="line">&quot;21&quot;</span><br><span class="line">localRedis:0&gt;get age</span><br><span class="line">&quot;21&quot;</span><br><span class="line">localRedis:0&gt;incr age2</span><br><span class="line">&quot;1&quot;</span><br></pre></td></tr></table></figure>
<p>对 key 的值做加加操作,并返回新的值。注意 incr 一个不是 int 的 value 会返回错误，incr 一个不存在的 key，则设置 key 为 1</p>
<h3 id="2-2-12-incrby">2.2.12 incrby</h3>
<p>同 incr 类似，加指定值 ，key 不存在时候会设置 key，并认为原来的 value 是 0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;set age 10</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">localRedis:0&gt;incr age 10</span><br><span class="line">&quot;ERR wrong number of arguments for &#x27;incr&#x27; command&quot;</span><br><span class="line">localRedis:0&gt;incrby age 10</span><br><span class="line">&quot;20&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-13-decr">2.2.13 decr</h3>
<p>对 key 的值做的是减减操作，decr 一个不存在 key，则设置 key 为-1</p>
<h3 id="2-2-14-decrby">2.2.14 decrby</h3>
<p>同incrby相反</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;25&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; decrby age 5</span><br><span class="line">(integer) 20</span><br><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;20&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; incrby age -5</span><br><span class="line">(integer) 15</span><br><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;15&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-15-append">2.2.15 append</h3>
<p>给指定 key 的字符串值追加 value,返回新字符串值的长度。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;setnx email 477606127</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;get email</span><br><span class="line">&quot;477606127&quot;</span><br><span class="line">localRedis:0&gt;append email @qq.com</span><br><span class="line">&quot;16&quot;</span><br><span class="line">localRedis:0&gt;get email</span><br><span class="line">&quot;477606127@qq.com&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-16-strlen">2.2.16 strlen</h3>
<p>取指定 key 的 value 值的长度。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;HongWan_new&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; strlen name</span><br><span class="line">(integer) 11</span><br><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;15&quot;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-hashes-类型及操作">2.3 hashes 类型及操作</h2>
<p>Redis hash 是一个 string 类型的 field 和 value 的映射表.它的添加、删除操作都是 O(1)（平均）。<br>
hash 特别适合用于存储对象。相较于将对象的每个字段存成单个 string 类型。将一个对象存储在 hash 类型中会占用更少的内存，并且可以更方便的存取整个对象。省内存的原因是新建一个 hash 对象时开始是用 zipmap（又称为 small hash）来存储的。这个 zipmap 其实并不是 hash table，但是 zipmap 相比正常的 hash 实现可以节省不少hash 本身需要的一些元数据存储开销。尽管 zipmap 的添加，删除，查找都是 O(n)，但是由于一般对象的 field 数量都不太多。所以使用 zipmap 也是很快的,也就是说添加删除平均还是 O(1)。如果 field 或者 value的大小超出一定限制后，Redis 会在内部自动将zipmap 替换成正常的 hash 实现. 这个限制可以在配置文件中指定<br>
hash-max-zipmap-entries 64 #配置字段最多 64 个<br>
hash-max-zipmap-value 512 #配置 value 最大为 512 字节</p>
<h3 id="2-3-1-hset">2.3.1 hset</h3>
<p>设置 hash field 为指定值，如果 key 不存在，则先创建。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hset myhash field1 Hello</span><br><span class="line">(integer) 1</span><br><span class="line">localRedis:0&gt;hget myhash field1 </span><br><span class="line">&quot;hello&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-2-hsetnx">2.3.2 hsetnx</h3>
<p>设置 hash field 为指定值，如果 key 不存在，则先创建。如果 field 已经存在，返回 0，nx 是not exist 的意思。</p>
<p>第一次执行是成功的，但第二次执行相同的命令失败，原因是 field 已经存在了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hsetnx myhash field &quot;Hello&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; hsetnx myhash field &quot;Hello&quot;</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-3-hmset">2.3.3 hmset</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hmset myhash field1 Hello field2 World</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-3-4-hget">2.3.4 hget</h3>
<p>获取指定的 hash field。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hget myhash field1</span><br><span class="line">&quot;Hello&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; hget myhash field2</span><br><span class="line">&quot;World&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; hget myhash field3</span><br><span class="line">(null)</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>由于数据库没有 field3，所以取到的是一个空值 null</p>
<h3 id="2-3-5-hmget">2.3.5 hmget</h3>
<p>和上面mget差不多</p>
<p>redis 127.0.0.1:6379&gt; hmget myhash field1 field2 field3</p>
<h3 id="2-3-6-hincrby">2.3.6 hincrby</h3>
<p>指定的 hash filed 加上给定值。这不比之前的incr decr incrby decrby 方便多了？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;hsetnx myhash field3 20</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;hget myhash field3</span><br><span class="line">&quot;20&quot;</span><br><span class="line">localRedis:0&gt;hincrby myhash field3 -8</span><br><span class="line">&quot;12&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-7-hexists">2.3.7 hexists</h3>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">localRedis:</span><span class="number">0</span>&gt;hexists myhash field3</span><br><span class="line"><span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="symbol">localRedis:</span><span class="number">0</span>&gt;hexists myhash field9</span><br><span class="line"><span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="symbol">localRedis:</span><span class="number">0</span>&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-8-hlen">2.3.8 hlen</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hlen myhash</span><br><span class="line">(integer) 4</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-9-hdel">2.3.9 hdel</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hlen myhash</span><br><span class="line">(integer) 4</span><br><span class="line">redis 127.0.0.1:6379&gt; hdel myhash field1</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; hlen myhash</span><br><span class="line">(integer) 3</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-10-hkeys">2.3.10 hkeys</h3>
<p>显示hash里的所有key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hkeys myhash</span><br><span class="line">1) &quot;field2&quot;</span><br><span class="line">2) &quot;field&quot;</span><br><span class="line">3) &quot;field3&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-11-hvals">2.3.11 hvals</h3>
<p>返回hash里所有value</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hvals myhash</span><br><span class="line">1) &quot;World&quot;</span><br><span class="line">2) &quot;Hello&quot;</span><br><span class="line">3) &quot;12&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-12-hgetall">2.3.12 hgetall</h3>
<p>key和value都获得</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hgetall myhash</span><br><span class="line">1) &quot;field2&quot;</span><br><span class="line">2) &quot;World&quot;</span><br><span class="line">3) &quot;field&quot;</span><br><span class="line">4) &quot;Hello&quot;</span><br><span class="line">5) &quot;field3&quot;</span><br><span class="line">6) &quot;12&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h2 id="2-4-lists-类型及操作">2.4 lists 类型及操作</h2>
<p>list 是一个链表结构，主要功能是 push、pop、获取一个范围的所有值等等，操作中 key 理解为链表的名字。<br>
Redis 的 list 类型其实就是一个每个子元素都是 string 类型的双向链表。链表的最大长度是(2的 32 次方)。我们可以通过 push,pop 操作从链表的头部或者尾部添加删除元素。这使得 list既可以用作栈，也可以用作队列。</p>
<h3 id="2-4-1-lpush">2.4.1 lpush</h3>
<p>在 key 对应 list 的头部添加字符串元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;lpush mylist &quot;world&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;lpush mylist &quot;hello&quot;</span><br><span class="line">&quot;2&quot;</span><br><span class="line">localRedis:0&gt;lrange mylist 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-2-rpush">2.4.2 rpush</h3>
<p>在 key 对应 list 的尾部添加字符串元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; rpush mylist2 &quot;hello&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; rpush mylist2 &quot;world&quot;</span><br><span class="line">(integer) 2</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange mylist2 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-3-linsert">2.4.3 linsert</h3>
<p>在 key 对应 list 的特定位置之前或之后添加字符串元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;lrange mylist 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">3) &quot;!&quot;</span><br><span class="line">localRedis:0&gt;linsert mylist before &quot;world&quot; &quot;the&quot;</span><br><span class="line">&quot;4&quot;</span><br><span class="line">localRedis:0&gt;lrange mylist 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;the&quot;</span><br><span class="line">3) &quot;world&quot;</span><br><span class="line">4) &quot;!&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-4-lset">2.4.4 lset</h3>
<p>设置 list 中指定下标的元素值(下标从 0 开始)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;lrange mylist2 0 -1</span><br><span class="line">1) &quot;5&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;1&quot;</span><br><span class="line">localRedis:0&gt;lset mylist2 0 4</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">localRedis:0&gt;lrange mylist2 0 -1</span><br><span class="line">1) &quot;4&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;1&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-5-lrem">2.4.5 lrem</h3>
<p>从 key 对应 list 中删除 count 个和 value 相同的元素。<br>
count&gt;0 时，按从头到尾的顺序删除</p>
<p>count&lt;0 时，按从尾到头的顺序删除</p>
<p>count=0 时，删除全部</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;lrange mylist5 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">3) &quot;foo&quot;</span><br><span class="line">4) &quot;hello&quot;</span><br><span class="line">5) &quot;hello&quot;</span><br><span class="line">localRedis:0&gt;lrem mylist5 2 &quot;hello&quot;</span><br><span class="line">&quot;2&quot;</span><br><span class="line">localRedis:0&gt;lrange mylist5 0 -1</span><br><span class="line">1) &quot;foo&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">3) &quot;hello&quot;</span><br><span class="line">localRedis:0&gt;lrem mylist5 -1 &quot;hello&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;lrange mylist5 0 -1</span><br><span class="line">1) &quot;foo&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-6-ltrim">2.4.6 ltrim</h3>
<p>保留指定 key 的值范围内的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; rpush mylist8 &quot;one&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; rpush mylist8 &quot;two&quot;</span><br><span class="line">(integer) 2</span><br><span class="line">redis 127.0.0.1:6379&gt; rpush mylist8 &quot;three&quot;</span><br><span class="line">(integer) 3</span><br><span class="line">redis 127.0.0.1:6379&gt; rpush mylist8 &quot;four&quot;</span><br><span class="line">(integer) 4</span><br><span class="line">redis 127.0.0.1:6379&gt; ltrim mylist8 1 -1</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange mylist8 0 -1</span><br><span class="line">1) &quot;two&quot;</span><br><span class="line">2) &quot;three&quot;</span><br><span class="line">3) &quot;four&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-7-lpop">2.4.7 lpop</h3>
<p>从 list 的头部删除元素，并返回删除元素 弹出头元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; lpop mylist</span><br><span class="line">&quot;hello&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) &quot;world&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-8-rpop">2.4.8 rpop</h3>
<p>从 list 的尾部删除元素，并返回删除元素  弹出尾元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; lrange mylist2 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; rpop mylist2</span><br><span class="line">&quot;world&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange mylist2 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-9-rpoplpush">2.4.9 rpoplpush</h3>
<p>从第一个 list 的尾部移除元素并添加到第二个 list 的头部,最后返回被移除的元素值，整个操作是原子的.如果第一个 list 是空或者不存在返回 null</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; lrange mylist5 0 -1</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;foo&quot;</span><br><span class="line">3) &quot;hello&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange mylist6 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;foo&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; rpoplpush mylist5 mylist6</span><br><span class="line">&quot;hello&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange mylist5 0 -1</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;foo&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange mylist6 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">3) &quot;foo&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-10-lindex">2.4.10 lindex</h3>
<p>返回名称为 key 的 list 中 index 位置的元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; lrange mylist5 0 -1</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;foo&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; lindex mylist5 0</span><br><span class="line">&quot;three&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; lindex mylist5 1</span><br><span class="line">&quot;foo&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-11-llen">2.4.11 llen</h3>
<p>返回 key 对应 list 的长度</p>
<h2 id="2-5-sets-类型及操作">2.5 sets 类型及操作</h2>
<p>set 是集合，和我们数学中的集合概念相似，对集合的操作有添加删除元素，有对多个集合求交并差等操作，操作中 key 理解为集合的名字。</p>
<p><strong>Redis 的 set 是 string 类型的无序集合。set 元素最大可以包含(2 的 32 次方)个元素</strong></p>
<p>set 的是通过 hash table 实现的，所以添加、删除和查找的复杂度都是 O(1)。hash table 会随着添加或者删除自动的调整大小。需要注意的是调整 hash table 大小时候需要同步（获取写锁）会阻塞其他读写操作，可能不久后就会改用跳表（skip list）来实现，跳表已经在 sorted set 中使用了。关于 set 集合类型除了基本的添加删除操作，其他有用的操作还包含集合的取并集(union)，交集(intersection)，差集(difference)。通过这些操作可以很容易的实现 sns中的好友推荐和 blog 的 tag 功能。下面详细介绍 set 相关命令</p>
<h3 id="2-5-1-sadd">2.5.1 sadd</h3>
<p>集合元素不重复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;sadd myset &quot;hello&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;sadd myset &quot;world&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;sadd myset &quot;world&quot;</span><br><span class="line">&quot;0&quot;</span><br><span class="line">localRedis:0&gt;smembers myset</span><br><span class="line">1) &quot;world&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-2-srem">2.5.2 srem</h3>
<p>删除名称为 key 的 set 中的元素 member</p>
<h3 id="2-5-3-spop">2.5.3 spop</h3>
<p>随机返回并删除名称为 key 的 set 中一个元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; sadd myset3 &quot;one&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; sadd myset3 &quot;two&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; sadd myset3 &quot;three&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; spop myset3</span><br><span class="line">&quot;three&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; smembers myset3</span><br><span class="line">1) &quot;two&quot;</span><br><span class="line">2) &quot;one&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-4-sdiff-差集">2.5.4 sdiff (差集)</h3>
<p>返回所有给定 key 与第一个 key 的差集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;smembers myset2</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">localRedis:0&gt;smembers myset3</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;sdiff myset2 myset3</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">localRedis:0&gt;sdiff myset3 myset2</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-4-sdiffstore">2.5.4 sdiffstore</h3>
<p>返回所有给定 key 与第一个 key 的差集，并将结果存为另一个 key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;smembers myset2</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">localRedis:0&gt;smembers myset3</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;sdiffstore myset4 myset2 myset3</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;smembers myset4</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-6-sinter-交集">2.5.6 sinter (交集)</h3>
<p>返回所有给定 key 的交集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;smembers myset2</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">localRedis:0&gt;smembers myset3</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line"></span><br><span class="line">localRedis:0&gt;sinter myset2 myset3</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-7-sinterstore">2.5.7 sinterstore</h3>
<p>同sdiffstore差不多</p>
<h3 id="2-5-8-sunion-并集">2.5.8 sunion (并集)</h3>
<p>返回所有给定 key 的并集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;smembers myset2</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">localRedis:0&gt;smembers myset3</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line"></span><br><span class="line">localRedis:0&gt;sunion myset2 myset3</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-9-sunionstore">2.5.9 sunionstore</h3>
<p>同之前store差不多</p>
<p>返回所有给定 key 的并集，并将结果存为另一个</p>
<p>keysunionstore myset6 myset2 myset3</p>
<h3 id="2-5-10-smove">2.5.10 smove</h3>
<p>移动set的key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;SMEMBERS myset2</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">localRedis:0&gt;SMEMBERS myset3</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;smove myset2 myset7 1 </span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;SMEMBERS myset2</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">localRedis:0&gt;SMEMBERS myset7</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-11-scard-set个数">2.5.11 scard (set个数)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;scard myset3</span><br><span class="line">&quot;2&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-12-sismember-s-ismeber">2.5.12 sismember (s ismeber?)</h3>
<p>测试 member 是否是名称为 key 的 set 的元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;smembers myset3</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;SISMEMBEr myset3 2</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;SISMEMBEr myset3 1</span><br><span class="line">&quot;0&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-13-srandmember">2.5.13 srandmember</h3>
<p>随机返回名称为 key 的 set 的一个元素，但是不删除元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;smembers myset3</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;srandmember myset3</span><br><span class="line">&quot;2&quot;</span><br><span class="line">localRedis:0&gt;srandmember myset3</span><br><span class="line">&quot;2&quot;</span><br><span class="line">localRedis:0&gt;srandmember myset3</span><br><span class="line">&quot;3&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2-6-sorted-sets-类型及操作">2.6 sorted sets 类型及操作</h2>
<p>sorted set 是 set 的一个升级版本，它在 set 的基础上增加了一个顺序属性，这一属性在添加修改元素的时候可以指定，每次指定后，zset 会自动重新按新的值调整顺序。可以理解为有两列的 mysql 表，一列存 value，一列存顺序。操作中 key 理解为 zset 的名字。</p>
<p>和 set 一样 sorted set 也是 string 类型元素的集合，不同的是每个元素都会关联一个 double类型的 score。sorted set 的实现是 skip list 和 hash table 的混合体。</p>
<p>当元素被添加到集合中时，一个元素到 score 的映射被添加到 hash table 中，所以给定一个元素获取 score 的开销是 O(1),另一个 score 到元素的映射被添加到 skip list，并按照 score 排序，所以就可以有序的获取集合中的元素。添加，删除操作开销都是 O(log(N))和 skip list 的开销一致,redis 的 skip list 实现用的是双向链表,这样就可以逆序从尾部取元素。sorted set 最经常的使用方式应该是作为索引来使用.我们可以把要排序的字段作为 score 存储，对象的 id当元素存储。下面是 sorted set 相关命令</p>
<h3 id="2-6-1-zadd">2.6.1 zadd</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;zadd myzset 1 &quot;one&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;zadd myzset 2 &quot;two&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;zadd myzset 3 &quot;two&quot;</span><br><span class="line">&quot;0&quot;</span><br><span class="line">localRedis:0&gt;zrange myzset 0 -1 withscores</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">4) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<p>本例中我们向 myzset 中添加了 one 和 two，并且 two 被设置了 2 次，那么将以最后一次的<br>
设置为准，最后我们将所有元素都显示出来并显示出了元素的 score。</p>
<h3 id="2-6-2-zrem">2.6.2 zrem</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;zrange myzset 0 -1 withscores</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">4) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;zrem myzset two</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;zrange myzset 0 -1 withscores</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-3-zincrby">2.6.3 zincrby</h3>
<p>如果在名称为 key 的 zset 中已经存在元素 member，则该元素的 score 增加increment；否则向集合中添加该元素，其 score 的值为 increment</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;zadd myzset2 1 &quot;one&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;zadd myzset2 2 &quot;two&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;zincrby myzset2 2 &quot;one&quot;</span><br><span class="line">&quot;3&quot;</span><br><span class="line">localRedis:0&gt;zrange myzset2 0 -1 withscores</span><br><span class="line">1) &quot;two&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;one&quot;</span><br><span class="line">4) &quot;3&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<p>本例中将 one 的 score 从 1 增加了 2，增加到了 3</p>
<h3 id="2-6-4-zrank">2.6.4 zrank</h3>
<p>返回名称为 key 的 zset 中 member 元素的排名(按 score 从小到大排序)即下标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;zadd myzset3 1 &quot;one&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;zadd myzset3 2 &quot;two&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;zadd myzset3 3 &quot;three&quot;</span><br><span class="line">&quot;1&quot;</span><br><span class="line">-----------------------------------</span><br><span class="line">localRedis:0&gt;zrank myzset3 one</span><br><span class="line">&quot;0&quot;</span><br><span class="line">localRedis:0&gt;zrank myzset3 two</span><br><span class="line">&quot;1&quot;</span><br><span class="line">localRedis:0&gt;zrank myzset3 three</span><br><span class="line">&quot;2&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<p>本例中将 two 的下标是 1，这里取的是下标，而不是 score</p>
<h3 id="2-6-5-zrevrank">2.6.5 zrevrank</h3>
<p>返回名称为 key 的 zset 中 member 元素的排名(按 score 从大到小排序)即下标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;zrange myzset3 0 -1 </span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;two&quot;</span><br><span class="line">3) &quot;three&quot;</span><br><span class="line">localRedis:0&gt;zrank myzset3 one</span><br><span class="line">&quot;0&quot;</span><br><span class="line">localRedis:0&gt;zrevrank myzset3 one</span><br><span class="line">&quot;2&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-6-zrevrange">2.6.6 zrevrange</h3>
<p>返回名称为 key 的 zset（按 score 从大到小排序）中的 index 从 start 到 end 的所有元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores</span><br><span class="line">1) &quot;five&quot;</span><br><span class="line">2) &quot;5&quot;</span><br><span class="line">3) &quot;three&quot;</span><br><span class="line">4) &quot;3&quot;</span><br><span class="line">5) &quot;two&quot;</span><br><span class="line">6) &quot;2&quot;</span><br><span class="line">7) &quot;one&quot;</span><br><span class="line">8) &quot;1&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-7-zrangebyscore">2.6.7 zrangebyscore</h3>
<p>返回集合中 score 在给定区间(闭区间)的元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;three&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">7) &quot;five&quot;</span><br><span class="line">8) &quot;5&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; zrangebyscore myzset3 2 3 withscores</span><br><span class="line">1) &quot;two&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;three&quot;</span><br><span class="line">4) &quot;3&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-8-zcount">2.6.8 zcount</h3>
<p>返回集合中 score 在给定区间的数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;three&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">7) &quot;five&quot;</span><br><span class="line">8) &quot;5&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; zcount myzset3 2 3</span><br><span class="line">(integer) 2</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-9-zcard-元素个数">2.6.9 zcard (元素个数)</h3>
<p>返回集合中元素个数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;three&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">7) &quot;five&quot;</span><br><span class="line">8) &quot;5&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; zcard myzset3</span><br><span class="line">(integer) 4</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-10-zscore">2.6.10 zscore</h3>
<p>返回给定元素对应的 score</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;three&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">7) &quot;five&quot;</span><br><span class="line">8) &quot;5&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; zscore myzset3 two</span><br><span class="line">&quot;2&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>此例中我们成功的将 two 的 score 取出来了。</p>
<h3 id="2-6-11-zremrangebyrank">2.6.11 zremrangebyrank</h3>
<p>删除集合中排名在给定区间的元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;three&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">7) &quot;five&quot;</span><br><span class="line">8) &quot;5&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; zremrangebyrank myzset3 3 3</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;three&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>在本例中我们将 myzset3 中按从小到大排序结果的下标为 3 的元素删除了。</p>
<h3 id="2-6-12-zremrangebyscore">2.6.12 zremrangebyscore</h3>
<p>删除集合中 score 在给定区间的元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;zrange myzset3 0 -1 withscores</span><br><span class="line">1)  &quot;one&quot;</span><br><span class="line">2)  &quot;1&quot;</span><br><span class="line">3)  &quot;two&quot;</span><br><span class="line">4)  &quot;2&quot;</span><br><span class="line">5)  &quot;three&quot;</span><br><span class="line">6)  &quot;3&quot;</span><br><span class="line">7)  &quot;n&quot;</span><br><span class="line">8)  &quot;4&quot;</span><br><span class="line">9)  &quot;ni&quot;</span><br><span class="line">10) &quot;4&quot;</span><br><span class="line">localRedis:0&gt;zremrangebyscore myzset3 1 2</span><br><span class="line">&quot;2&quot;</span><br><span class="line">localRedis:0&gt;zrange myzset3 0 -1 withscores</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">3) &quot;n&quot;</span><br><span class="line">4) &quot;4&quot;</span><br><span class="line">5) &quot;ni&quot;</span><br><span class="line">6) &quot;4&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<p>将 myzset3 中按从小到大排序结果的 score 在 1~2 之间的元素删除了。</p>
<h1>第三章、Redis 常用命令</h1>
<h2 id="3-1-键值相关命令">3.1 键值相关命令</h2>
<h3 id="3-1-1-keys-列key表">3.1.1 keys (列key表)</h3>
<p>返回满足给定 pattern 的所有 key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;keys *</span><br><span class="line">1)  &quot;mylist2&quot;</span><br><span class="line">2)  &quot;myzset2&quot;</span><br><span class="line">3)  &quot;myset7&quot;</span><br><span class="line">4)  &quot;mylist&quot;</span><br><span class="line">5)  &quot;myset4&quot;</span><br><span class="line">6)  &quot;email&quot;</span><br><span class="line">7)  &quot;myhash&quot;</span><br><span class="line">8)  &quot;myset3&quot;</span><br><span class="line">9)  &quot;mylist5&quot;</span><br><span class="line">10) &quot;myset&quot;</span><br><span class="line">11) &quot;myzset3&quot;</span><br><span class="line">12) &quot;myzset&quot;</span><br><span class="line">13) &quot;myset2&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; keys mylist*</span><br><span class="line">1) &quot;mylist&quot;</span><br><span class="line">2) &quot;mylist5&quot;</span><br><span class="line">3) &quot;mylist6&quot;</span><br><span class="line">4) &quot;mylist7&quot;</span><br><span class="line">5) &quot;mylist8&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-exists">3.1.2 exists</h3>
<p>确认一个 key 是否存在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; exists HongWan</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; exists age</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-3-del">3.1.3 del</h3>
<p>删除一个 key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; del age</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; exists age</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-4-expire-设过期时间">3.1.4 expire (设过期时间)</h3>
<p>设置一个 key 的过期时间(单位:秒)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> redis 127.0.0.1:6379&gt; expire addr 10</span><br><span class="line"> redis 127.0.0.1:6379&gt; ttl addr</span><br><span class="line">(integer) 8</span><br><span class="line">redis 127.0.0.1:6379&gt; ttl addr</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; ttl addr</span><br><span class="line">(integer) -1</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>我们设置 addr 这个 key 的过期时间是 10 秒，然后我们不断的用 ttl 来获取这个key 的有效时长，直至为-1 说明此值已过期</p>
<h3 id="3-1-5-move">3.1.5 move</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; select 0</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; set age 30</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;30&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; move age 1</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">(nil)</span><br><span class="line">redis 127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379[1]&gt; get age</span><br><span class="line">&quot;30&quot;</span><br><span class="line">redis 127.0.0.1:6379[1]&gt;</span><br></pre></td></tr></table></figure>
<p>在本例中，我先显式的选择了数据库 0，然后在这个库中设置一个 key，接下来我们将这个key 从数据库 0 移到数据库 1，之后我们确认在数据库 0 中无此 key 了, 但在数据库 1 中存在这个 key，说明我们转移成功了</p>
<h3 id="3-1-6-persist-移除过期时间">3.1.6 persist (移除过期时间)</h3>
<p>移除给定 key 的过期时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379[1]&gt; expire age 300</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379[1]&gt; ttl age</span><br><span class="line">(integer) 294</span><br><span class="line">redis 127.0.0.1:6379[1]&gt; persist age</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379[1]&gt; ttl age</span><br><span class="line">(integer) -1</span><br><span class="line">redis 127.0.0.1:6379[1]&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-1-7-randomkey">3.1.7 randomkey</h3>
<p>随机返回 key 空间的一个 key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; randomkey</span><br><span class="line">&quot;mylist7&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; randomkey</span><br><span class="line">&quot;mylist5&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>通过结果可以看到取 key 的规则是随机的</p>
<h3 id="3-1-8-rename">3.1.8 rename</h3>
<p>重命名 key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">localRedis:0&gt;rename email mail</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">localRedis:0&gt;keys mai*</span><br><span class="line">1) &quot;mail&quot;</span><br><span class="line">localRedis:0&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-9-type">3.1.9 type</h3>
<p>返回值的类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; type addr</span><br><span class="line">string</span><br><span class="line">redis 127.0.0.1:6379&gt; type myzset2</span><br><span class="line">zset</span><br><span class="line">redis 127.0.0.1:6379&gt; type mylist</span><br><span class="line">list</span><br><span class="line">redis 127.0.0.1:6379&gt;type myset4</span><br><span class="line">set</span><br></pre></td></tr></table></figure>
<h2 id="3-2-服务器相关命令">3.2 服务器相关命令</h2>
<h3 id="3-2-1-ping">3.2.1 ping</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">//执行下面命令之前，我们停止 redis 服务器</span><br><span class="line">redis 127.0.0.1:6379&gt; ping</span><br><span class="line">Could not connect to Redis at 127.0.0.1:6379: Connection refused</span><br><span class="line">//执行下面命令之前，我们启动 redis 服务器</span><br><span class="line">not connected&gt; ping</span><br><span class="line">PONG</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-echo">3.2.2 echo</h3>
<p>打印内容(这在redis有啥用？)</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localRedi<span class="variable">s:0</span>&gt;<span class="keyword">echo</span> nmsl</span><br><span class="line"><span class="string">&quot;nmsl&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-select-选取切换数据库">3.2.3 select (选取切换数据库)</h3>
<p>选择数据库。Redis 数据库编号从 0~15，我们可以选择任意一个数据库来进行数据的存取。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379[1]&gt; select 16</span><br><span class="line">(error) ERR invalid DB index</span><br><span class="line">redis 127.0.0.1:6379[16]&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-4-quit">3.2.4 quit</h3>
<p>退出连接。</p>
<h3 id="3-2-5-dbsize-返回当前数据库中-key-的数目">3.2.5 dbsize (返回当前数据库中 key 的数目)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; dbsize</span><br><span class="line">(integer) 18</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-6-info">3.2.6 info</h3>
<p>获取服务器的信息和统计</p>
<h3 id="3-2-7-monitor-监控">3.2.7 monitor(监控)</h3>
<p>用于实时打印出 Redis 服务器接收到的命令，调试用。</p>
<p>quit退出</p>
<p>很坑的地方他quit退出也是显示OK就不能这两区别下吗？我还以为是一样的</p>
<h3 id="3-2-8-config-get-获取服务器配置信息">3.2.8 config get(获取服务器配置信息)</h3>
<p>获取服务器配置信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; config get dir</span><br><span class="line">1) &quot;dir&quot;</span><br><span class="line">2) &quot;/root/4setup/redis-2.2.12&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-2-9-flushdb-删除当前选择数据库中的所有-key">3.2.9 flushdb (删除当前选择数据库中的所有 key)</h3>
<p>删除当前选择数据库中的所有 key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; dbsize</span><br><span class="line">(integer) 18</span><br><span class="line">redis 127.0.0.1:6379&gt; flushdb</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; dbsize</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-10-flushdb-删除所有数据库中的所有-key">3.2.10 flushdb (删除所有数据库中的所有 key)</h3>
<p>删除所有数据库中的所有 key</p>
<hr>
<h2 id="第四章-Redis-高级实用特性">第四章 Redis 高级实用特性</h2>
<h3 id="4-1-安全性">4.1 安全性</h3>
<p>设置客户端连接后进行任何其他指定前需要使用的密码。<br>
警告：因为 redis 速度相当快，所以在一台比较好的服务器下，一个外部的用户可以在一秒钟进行 150K 次的密码尝试，这意味着你需要指定非常非常强大的密码来防止暴力破解。<br>
下面我们做一个实验，说明 redis 的安全性是如何实现的。</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">requirepass beijing</span></span><br></pre></td></tr></table></figure>
<p>我们设置了连接的口令是 beijing<br>
那么们启动一个客户端试一下:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> redis-<span class="number">2.2</span><span class="number">.12</span>]<span class="comment"># src/redis-cli </span></span><br><span class="line">redis <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; <span class="keyword">keys</span> *</span><br><span class="line">(error) ERR operation <span class="keyword">not</span> permitted</span><br><span class="line">redis <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt;</span><br></pre></td></tr></table></figure>
<p>说明权限太小，我们可以当前的这个窗口中设置口令</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">redis</span> <span class="number">127.0.0.1:6379</span>&gt; auth beijing</span><br><span class="line">OK</span><br><span class="line">redis <span class="number">127.0.0.1:6379</span>&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">redis <span class="number">127.0.0.1:6379</span>&gt;</span><br></pre></td></tr></table></figure>
<p>我们还可以在连接到服务器期间就指定一个口令，如下:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost redis-2.2.12]</span># <span class="attribute">src</span>/redis-cli -<span class="selector-tag">a</span> beijing</span><br><span class="line">redis <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">redis <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到我们在连接的时候就可以指定一个口令。</p>
<h3 id="4-2-主从复制">4.2 主从复制</h3>
<p>redis 主从复制配置和使用都非常简单。通过主从复制可以允许多个 slave server 拥有和master server 相同的数据库副本。</p>
<h4 id="4-2-1-redis-主从复制特点">4.2.1 redis 主从复制特点:</h4>
<p>​	(1)、master 可以拥有多个 slave</p>
<p>​	(2)、多个 slave 可以连接同一个 master 外，还可以连接到其他 slave</p>
<p>​	(3)、主从复制不会阻塞 master，在同步数据时，master 可以继续处理 client 请求</p>
<p>​	(4)、提高系统的伸缩性</p>
<h4 id="4-2-2-redis-主从复制过程">4.2.2 redis 主从复制过程:</h4>
<p>​	当配置好 slave 后，slave 与 master 建立连接，然后发送 sync 命令。无论是第一次连接还是重新连接，master 都会启动一个后台进程，将数据库快照保存到文件中，同时 master 主进程会开始收集新的写命令并缓存。后台进程完成写文件后，master 就发送文件给 slave，slave将文件保存到硬盘上，再加载到内存中，接着 master 就会把缓存的命令转发给 slave，后续master 将收到的写命令发送给 slave。如果 master 同时收到多个 slave 发来的同步连接命令，master 只会启动一个进程来写数据库镜像，然后发送给所有的 slave。</p>
<h4 id="4-2-3-如何配置">4.2.3 如何配置</h4>
<h3 id="4-3-事务控制">4.3 事务控制</h3>
<h4 id="4-3-1-简单事务控制-事务执行">4.3.1 简单事务控制(事务执行)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">下面可以看一个例子</span><br><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;33&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; set age 10</span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; set age 20</span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;20&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>从这个例子我们可以看到 2 个 set age 命令发出后并没执行而是被放到了队列中。调用 exec<br>
后 2 个命令才被连续的执行，最后返回的是两条命令执行后的结果。</p>
<h4 id="4-3-2-如何取消一个事务-事务回滚">4.3.2 如何取消一个事务(事务回滚)</h4>
<p>我们可以调用 <strong>discard</strong> 命令来取消一个事务，让事务回滚。接着上面例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;20&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; set age 30</span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; set age 40</span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; discard</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;20&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>可以发现这次 2 个 set age 命令都没被执行。discard 命令其实就是清空事务的命令队列并退<br>
出事务上下文，也就是我们常说的事务回滚。</p>
<h4 id="4-3-3-乐观锁复杂事务控制">4.3.3 乐观锁复杂事务控制</h4>
<p><strong>乐观锁</strong>：大多数是基于数据版本（version）的记录机制实现的。何谓数据版本？即为数据增加一个版本标识，在基于数据库表的版本解决方案中，一般是通过为数据库表添加一个“version”字段来实现读取出数据时，将此版本号一同读出，之后更新时，对此版本号加 1。此时，将提交数据的版本号与数据库表对应记录的当前版本号进行比对，如果提交的数据版本号大于数据库表当前版本号，则予以更新，否则认为是过期数据。</p>
<p><strong>乐观锁实例</strong>：假设数据库中帐户信息表中有一个 version 字段，当前值为 1；而当前帐户余额字段（balance）为$100。下面我们将用时序表的方式来为大家演示乐观锁的实现原理：</p>
<table>
<thead>
<tr>
<th>操作员 A</th>
<th>操作员 B</th>
</tr>
</thead>
<tbody>
<tr>
<td>1)、操作员 A 此时将用户信息读出（此时version=1），并准备从其帐户余额中扣除$50（$100-$50）</td>
<td>(2)、在操作员 A 操作的过程中，操作员 B 也读入此用户信息（此时 version=1），并准备从其帐户余额中扣除$20（$100-$20）</td>
</tr>
<tr>
<td>3)、操作员 A 完成了修改工作，将数据版本号加 1（此时 version=2），连同帐户扣除后余额（balance=$50），提交至数据库更新，此时由于提交数据版本大于数据库记录当前版本，数据被更新，数据库记录 version更新为 2</td>
<td></td>
</tr>
<tr>
<td></td>
<td>(4)、操作员 B 完成了操作，也将版本号加 1（ version=2 ） 并 试 图 向 数 据 库 提 交 数 据（balance=$80），但此时比对数据库记录版本时发现，操作员 B 提交的数据版本号为 2，数据库记录当前版本也为 2，不满足“提交版本必须大于记录当前版本才能执行更新”的乐观锁策略，因此，操作员 B 的提交被驳回</td>
</tr>
</tbody>
</table>
<p>这样，就避免了操作员 B 用基于 version=1 的旧数据修改的结果来覆盖操作员 A 的操作结果的可能。</p>
<p>​	即然乐观锁比悲观锁要好很多，redis 是否也支持呢？答案是支持, redis 从 2.1.0 开始就支持乐观锁了，可以显式的使用 <strong>watch</strong> 对某个 <strong>key</strong> 进行加锁，避免悲观锁带来的一系列问题。<strong>Redis 乐观锁</strong>实例：假设有一个 age 的 key，我们开 2 个 session 来对 age 进行赋值操作，我们来看一下结果如何。</p>
<table>
<thead>
<tr>
<th><strong>Session 1</strong></th>
<th>Session 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>(1)第 1 步<br/>redis 127.0.0.1:6379&gt; get age<br/>“10”<br/>redis 127.0.0.1:6379&gt; watch age<br/>OK<br/>redis 127.0.0.1:6379&gt; multi<br/>OK<br/>redis 127.0.0.1:6379&gt;</td>
<td></td>
</tr>
<tr>
<td></td>
<td>(2)第 2 步<br/>redis 127.0.0.1:6379&gt; set age 30<br/>OK<br/>redis 127.0.0.1:6379&gt; get age<br/>“30”<br/>redis 127.0.0.1:6379&gt;</td>
</tr>
<tr>
<td>(3)第 3 步<br/>redis 127.0.0.1:6379&gt; set age 20<br/>QUEUED<br/>redis 127.0.0.1:6379&gt; exec<br/>(nil)<br/>redis 127.0.0.1:6379&gt; get age<br/>“30”<br/>redis 127.0.0.1:6379&gt;</td>
<td></td>
</tr>
</tbody>
</table>
<p>从以上实例可以看到在<br>
第一步，Session 1 还没有来得及对 age 的值进行修改<br>
第二步，Session 2 已经将 age 的值设为 30<br>
第三步，Session 1 希望将 age 的值设为 20，但结果一执行返回是 null，说明执行失败，之后我们再取一下 age 的值是 30，这是由于 Session 1 中对 age 加了乐观锁导致的。</p>
<p><strong>watch</strong> 命令会监视给定的 <strong>key</strong>,当 <strong>exec</strong> 时候如果监视的 <strong>key</strong> 从调用 <strong>watch</strong> 后发生过变化，则整个事务会失败。也可以调用 <strong>watch</strong> 多次监视多个 **key.**这 样就可以对指定的 <strong>key</strong> 加乐观锁了。注意 <strong>watch</strong> 的 <strong>key</strong> 是对整个连接有效的，事务也一样。如果连接断开，监视和事务都会被自动清除。当然了 <strong>exec,discard,unwatch</strong> 命令都会清除连接中的所有监视。</p>
<p>redis 的事务实现是如此简单，当然会存在一些问题。第一个问题是 redis 只能保证事务的每个命令连续执行，但是如果事务中的一个命令失败了，并不回滚其他命令，比如使用的命令类型不匹配。</p>
<h3 id="4-4-持久化机制">4.4 持久化机制</h3>
<p>redis 是一个支持持久化的内存数据库，也就是说 redis 需要经常将内存中的数据同步到磁盘来保证持久化。redis 支持两种持久化方式，一种是 Snapshotting（快照）也是默认方式，另一种是 Append-only file（缩写 aof）的方式。</p>
<h4 id="4-4-1-snapshotting-方式">4.4.1 snapshotting 方式</h4>
<p>快照是默认的持久化方式。这种方式是就是将内存中数据以快照的方式写入到二进制文件中,默认的文件名为 dump.rdb。可以通过配置设置自动做快照持久化的方式。我们可以配置 redis在 n 秒内如果超过 m 个 key 被修改就自动做快照，下面是默认的快照保存配置</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">save</span> <span class="number">900</span> <span class="number">1</span> #<span class="number">900</span> 秒内如果超过 <span class="number">1</span> 个 key 被修改，则发起快照保存</span><br><span class="line"><span class="attribute">save</span> <span class="number">300</span> <span class="number">10</span> #<span class="number">300</span> 秒内容如超过 <span class="number">10</span> 个 key 被修改，则发起快照保存</span><br><span class="line"><span class="attribute">save</span> <span class="number">60</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure>
<p>下面介绍详细的快照保存过程:</p>
<pre><code>1. redis 调用 fork,现在有了子进程和父进程。
</code></pre>
<ol start="2">
<li>
<p>父进程继续处理 client 请求，子进程负责将内存内容写入到临时文件。由于 os 的实时复制机制（copy on write)父子进程会共享相同的物理页面，当父进程处理写请求时 os 会为父进程要修改的页面创建副本，而不是写共享的页面。所以子进程地址空间内的数据是 fork时刻整个数据库的一个快照。</p>
</li>
<li>
<p>当子进程将快照写入临时文件完毕后，用临时文件替换原来的快照文件，然后子进程退出。<br>
client 也可以使用 save 或者 bgsave 命令通知 redis 做一次快照持久化。save 操作是在主线程中保存快照的，由于 redis 是用一个主线程来处理所有 client 的请求，这种方式会阻塞所有client 请求。所以不推荐使用。另一点需要注意的是，每次快照持久化都是将内存数据完整写入到磁盘一次，并不是增量的只同步变更数据。如果数据量大的话，而且写操作比较多，必然会引起大量的磁盘 io 操作，可能会严重影响性能。</p>
</li>
</ol>
<p>下面将演示各种场景的数据库持久化情况</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; set name HongWan</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;HongWan&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; shutdown</span><br><span class="line">redis 127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure>
<p>我们先设置了一个 name 的键值对，然后正常关闭了数据库实例，数据是否被保存到磁盘了呢？我们来看一下服务器端是否有消息被记录下来了:</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[6563] 09 Aug 18:58:58 * The server is now ready to accept connections on port 6379</span><br><span class="line">[6563] 09 Aug 18:58:58 - 0 clients connected (0 slaves), 539540 bytes in use</span><br><span class="line">[6563] 09 Aug 18:59:02 - Accepted 127.0.0.1:58005</span><br><span class="line">[6563] 09 Aug 18:59:03 - 1 clients connected (0 slaves), 547368 bytes in use</span><br><span class="line">[6563] 09 Aug 18:59:08 - 1 clients connected (0 slaves), 547424 bytes in use</span><br><span class="line">[6563] 09 Aug 18:59:12 # User requested shutdown...</span><br><span class="line">[6563] 09 Aug 18:59:12 * Saving the final RDB snapshot before exiting.</span><br><span class="line">[6563] 09 Aug 18:59:12 * DB saved on disk</span><br><span class="line">[6563] 09 Aug 18:59:12 # Redis is now ready to exit, bye bye...</span><br><span class="line">[root@localhost redis-2.2.12]#</span><br></pre></td></tr></table></figure>
<p>从日志可以看出，数据库做了一个存盘的操作，将内存的数据写入磁盘了。正常的话，磁盘上会产生一个 dump 文件，用于保存数据库快照，我们来验证一下:</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost redis-2.2.12]# ll</span><br><span class="line">总计 188</span><br><span class="line">-rw-rw-r-- 1 root root 9602 2011-07-22 00-RELEASENOTES</span><br><span class="line">-rw-rw-r-- 1 root root 55 2011-07-22 BUGS</span><br><span class="line">-rw-rw-r-- 1 root root 84050 2011-07-22 Changelog</span><br><span class="line">drwxrwxr-x 2 root root 4096 2011-07-22 client-libraries</span><br><span class="line">-rw-rw-r-- 1 root root 671 2011-07-22 CONTRIBUTING</span><br><span class="line">-rw-rw-r-- 1 root root 1487 2011-07-22 COPYING</span><br><span class="line">drwxrwxr-x 4 root root 4096 2011-07-22 deps</span><br><span class="line">drwxrwxr-x 2 root root 4096 2011-07-22 design-documents</span><br><span class="line">drwxrwxr-x 2 root root 12288 2011-07-22 doc</span><br><span class="line"></span><br><span class="line">-rw-r--r-- 1 root root 26 08-09 18:59 dump.rdb</span><br><span class="line">-rw-rw-r-- 1 root root 652 2011-07-22 INSTALL</span><br><span class="line">-rw-rw-r-- 1 root root 337 2011-07-22 Makefile</span><br><span class="line">-rw-rw-r-- 1 root root 1954 2011-07-22 README</span><br><span class="line">-rw-rw-r-- 1 root root 19067 08-09 18:48 redis.conf</span><br><span class="line">drwxrwxr-x 2 root root 4096 08-05 19:12 src</span><br><span class="line">drwxrwxr-x 7 root root 4096 2011-07-22 tests</span><br><span class="line">-rw-rw-r-- 1 root root 158 2011-07-22 TODO</span><br><span class="line">drwxrwxr-x 2 root root 4096 2011-07-22 utils</span><br><span class="line">[root@localhost redis-2.2.12]# </span><br></pre></td></tr></table></figure>
<p>硬盘上已经产生了一个数据库快照了。这时侯我们再将 redis 启动，看键值还是否真的持久化到硬盘了。</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">redis</span> <span class="number">127.0.0.1:6379</span>&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">redis <span class="number">127.0.0.1:6379</span>&gt; get name</span><br><span class="line"><span class="string">&quot;HongWan&quot;</span></span><br><span class="line">redis <span class="number">127.0.0.1:6379</span>&gt;</span><br></pre></td></tr></table></figure>
<p>数据被完全持久化到硬盘了。</p>
<p>数据被完全持久化到硬盘了。</p>
<h4 id="4-4-2-aof-方式-防止修改丢失">4.4.2 aof 方式(防止修改丢失)</h4>
<p>另外由于快照方式是在一定间隔时间做一次的，所以如果 redis 意外 down 掉的话，就会丢失最后一次快照后的所有修改。如果应用要求不能丢失任何修改的话，可以采用 aof 持久化方式。下面介绍 Append-only file:</p>
<p>aof 比快照方式有更好的持久化性，是由于在使用 aof 持久化方式时,redis 会将每一个收到的写命令都通过 write 函数追加到文件中(默认是 appendonly.aof)。当 redis 重启时会通过重新执行文件中保存的写命令来在内存中重建整个数据库的内容。当然由于 os 会在内核中缓存 write 做的修改，所以可能不是立即写到磁盘上。这样 aof 方式的持久化也还是有可能会丢失部分修改。不过我们可以通过配置文件告诉 redis 我们想要通过 fsync 函数强制 os 写入到磁盘的时机。有三种方式如下（默认是：每秒 fsync 一次）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes //启用 aof 持久化方式</span><br><span class="line"># appendfsync always //收到写命令就立即写入磁盘，最慢，但是保证完全的持久化</span><br><span class="line">appendfsync everysec //每秒钟写入磁盘一次，在性能和持久化方面做了很好的折中</span><br><span class="line"># appendfsync no //完全依赖 os，性能最好,持久化没保证</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Redis命令集合</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.fomal.cc/posts/778a1ca0.html">https://www.fomal.cc/posts/778a1ca0.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>Chenkt🥝</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2022-04-28</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2024-10-13</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/redis/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>redis</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投喂作者</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://tuchuang.voooe.cn/images/2023/01/04/2.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/01/04/2.webp" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tuchuang.voooe.cn/images/2023/01/04/20f8e49805975b8f8.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/01/04/20f8e49805975b8f8.webp" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/9b085c3b.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_14.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">springboot配置redis</div></div></a></div><div class="next-post pull-right"><a href="/posts/7c12b53f.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_14.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">入职第二天</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">第二章 Redis 数据类型及操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-strings-%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%93%8D%E4%BD%9C"><span class="toc-text">2.2 strings 类型及操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-set"><span class="toc-text">2.2.1 set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-setnx"><span class="toc-text">2.2.2 setnx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-setex"><span class="toc-text">2.2.3 setex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-setrange"><span class="toc-text">2.2.4 setrange</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-5-mset"><span class="toc-text">2.2.5 mset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-6-msetnx"><span class="toc-text">2.2.6 msetnx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-7-get"><span class="toc-text">2.2.7 get</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-8-getset"><span class="toc-text">2.2.8 getset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-9-getrange"><span class="toc-text">2.2.9 getrange</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-10-mget"><span class="toc-text">2.2.10 mget</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-11-incr"><span class="toc-text">2.2.11 incr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-12-incrby"><span class="toc-text">2.2.12 incrby</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-13-decr"><span class="toc-text">2.2.13 decr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-14-decrby"><span class="toc-text">2.2.14 decrby</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-15-append"><span class="toc-text">2.2.15 append</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-16-strlen"><span class="toc-text">2.2.16 strlen</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-hashes-%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%93%8D%E4%BD%9C"><span class="toc-text">2.3 hashes 类型及操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-hset"><span class="toc-text">2.3.1 hset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-hsetnx"><span class="toc-text">2.3.2 hsetnx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-hmset"><span class="toc-text">2.3.3 hmset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-hget"><span class="toc-text">2.3.4 hget</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-5-hmget"><span class="toc-text">2.3.5 hmget</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-6-hincrby"><span class="toc-text">2.3.6 hincrby</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-7-hexists"><span class="toc-text">2.3.7 hexists</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-8-hlen"><span class="toc-text">2.3.8 hlen</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-9-hdel"><span class="toc-text">2.3.9 hdel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-10-hkeys"><span class="toc-text">2.3.10 hkeys</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-11-hvals"><span class="toc-text">2.3.11 hvals</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-12-hgetall"><span class="toc-text">2.3.12 hgetall</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-lists-%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%93%8D%E4%BD%9C"><span class="toc-text">2.4 lists 类型及操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-lpush"><span class="toc-text">2.4.1 lpush</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-rpush"><span class="toc-text">2.4.2 rpush</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-linsert"><span class="toc-text">2.4.3 linsert</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-4-lset"><span class="toc-text">2.4.4 lset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-5-lrem"><span class="toc-text">2.4.5 lrem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-6-ltrim"><span class="toc-text">2.4.6 ltrim</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-7-lpop"><span class="toc-text">2.4.7 lpop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-8-rpop"><span class="toc-text">2.4.8 rpop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-9-rpoplpush"><span class="toc-text">2.4.9 rpoplpush</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-10-lindex"><span class="toc-text">2.4.10 lindex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-11-llen"><span class="toc-text">2.4.11 llen</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-sets-%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%93%8D%E4%BD%9C"><span class="toc-text">2.5 sets 类型及操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1-sadd"><span class="toc-text">2.5.1 sadd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-srem"><span class="toc-text">2.5.2 srem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-3-spop"><span class="toc-text">2.5.3 spop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-4-sdiff-%E5%B7%AE%E9%9B%86"><span class="toc-text">2.5.4 sdiff (差集)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-4-sdiffstore"><span class="toc-text">2.5.4 sdiffstore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-6-sinter-%E4%BA%A4%E9%9B%86"><span class="toc-text">2.5.6 sinter (交集)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-7-sinterstore"><span class="toc-text">2.5.7 sinterstore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-8-sunion-%E5%B9%B6%E9%9B%86"><span class="toc-text">2.5.8 sunion (并集)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-9-sunionstore"><span class="toc-text">2.5.9 sunionstore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-10-smove"><span class="toc-text">2.5.10 smove</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-11-scard-set%E4%B8%AA%E6%95%B0"><span class="toc-text">2.5.11 scard (set个数)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-12-sismember-s-ismeber"><span class="toc-text">2.5.12 sismember (s ismeber?)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-13-srandmember"><span class="toc-text">2.5.13 srandmember</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-sorted-sets-%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%93%8D%E4%BD%9C"><span class="toc-text">2.6 sorted sets 类型及操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-1-zadd"><span class="toc-text">2.6.1 zadd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-2-zrem"><span class="toc-text">2.6.2 zrem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-3-zincrby"><span class="toc-text">2.6.3 zincrby</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-4-zrank"><span class="toc-text">2.6.4 zrank</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-5-zrevrank"><span class="toc-text">2.6.5 zrevrank</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-6-zrevrange"><span class="toc-text">2.6.6 zrevrange</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-7-zrangebyscore"><span class="toc-text">2.6.7 zrangebyscore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-8-zcount"><span class="toc-text">2.6.8 zcount</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-9-zcard-%E5%85%83%E7%B4%A0%E4%B8%AA%E6%95%B0"><span class="toc-text">2.6.9 zcard (元素个数)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-10-zscore"><span class="toc-text">2.6.10 zscore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-11-zremrangebyrank"><span class="toc-text">2.6.11 zremrangebyrank</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-12-zremrangebyscore"><span class="toc-text">2.6.12 zremrangebyscore</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">第三章、Redis 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E9%94%AE%E5%80%BC%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-text">3.1 键值相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-keys-%E5%88%97key%E8%A1%A8"><span class="toc-text">3.1.1 keys (列key表)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-exists"><span class="toc-text">3.1.2 exists</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-del"><span class="toc-text">3.1.3 del</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4-expire-%E8%AE%BE%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="toc-text">3.1.4 expire (设过期时间)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-5-move"><span class="toc-text">3.1.5 move</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-6-persist-%E7%A7%BB%E9%99%A4%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="toc-text">3.1.6 persist (移除过期时间)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-7-randomkey"><span class="toc-text">3.1.7 randomkey</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-8-rename"><span class="toc-text">3.1.8 rename</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-9-type"><span class="toc-text">3.1.9 type</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-text">3.2 服务器相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-ping"><span class="toc-text">3.2.1 ping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-echo"><span class="toc-text">3.2.2 echo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-select-%E9%80%89%E5%8F%96%E5%88%87%E6%8D%A2%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">3.2.3 select (选取切换数据库)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-quit"><span class="toc-text">3.2.4 quit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-dbsize-%E8%BF%94%E5%9B%9E%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD-key-%E7%9A%84%E6%95%B0%E7%9B%AE"><span class="toc-text">3.2.5 dbsize (返回当前数据库中 key 的数目)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-6-info"><span class="toc-text">3.2.6 info</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-7-monitor-%E7%9B%91%E6%8E%A7"><span class="toc-text">3.2.7 monitor(监控)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-8-config-get-%E8%8E%B7%E5%8F%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-text">3.2.8 config get(获取服务器配置信息)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-9-flushdb-%E5%88%A0%E9%99%A4%E5%BD%93%E5%89%8D%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89-key"><span class="toc-text">3.2.9 flushdb (删除当前选择数据库中的所有 key)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-10-flushdb-%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89-key"><span class="toc-text">3.2.10 flushdb (删除所有数据库中的所有 key)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-Redis-%E9%AB%98%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%89%B9%E6%80%A7"><span class="toc-text">第四章 Redis 高级实用特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-text">4.1 安全性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">4.2 主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%89%B9%E7%82%B9"><span class="toc-text">4.2.1 redis 主从复制特点:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E8%BF%87%E7%A8%8B"><span class="toc-text">4.2.2 redis 主从复制过程:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE"><span class="toc-text">4.2.3 如何配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-text">4.3 事务控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E7%AE%80%E5%8D%95%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6-%E4%BA%8B%E5%8A%A1%E6%89%A7%E8%A1%8C"><span class="toc-text">4.3.1 简单事务控制(事务执行)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-%E5%A6%82%E4%BD%95%E5%8F%96%E6%B6%88%E4%B8%80%E4%B8%AA%E4%BA%8B%E5%8A%A1-%E4%BA%8B%E5%8A%A1%E5%9B%9E%E6%BB%9A"><span class="toc-text">4.3.2 如何取消一个事务(事务回滚)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-%E4%B9%90%E8%A7%82%E9%94%81%E5%A4%8D%E6%9D%82%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-text">4.3.3 乐观锁复杂事务控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6"><span class="toc-text">4.4 持久化机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-snapshotting-%E6%96%B9%E5%BC%8F"><span class="toc-text">4.4.1 snapshotting 方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-aof-%E6%96%B9%E5%BC%8F-%E9%98%B2%E6%AD%A2%E4%BF%AE%E6%94%B9%E4%B8%A2%E5%A4%B1"><span class="toc-text">4.4.2 aof 方式(防止修改丢失)</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/posts/eec9786.html">魔改指南</a><a href="/box/nav/">网址导航</a></li><li><a href="/social/link/">我的朋友</a><a href="/comments/">留点什么</a></li><li><a href="/personal/about/">关于作者</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/box/Gallery/">我的画廊</a><a href="/personal/bb/">我的唠叨</a></li><li><a href="/site/time/">建设进程</a><a href="/site/census/">网站统计</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"><a href="https://www.fomal.cc/" title="Fomalhaut🥝"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/60e5d4e39da7c077.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2022-2024</b></span><span><b>&nbsp;&nbsp;By Chenkt🥝</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="本站数据分析得益于51la技术支持"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20226665号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/萌ICP备-20226665-fe1384.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="本网站经Service Worker分流至缤纷云对象存储"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Bucket-缤纷云-9c62da.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="本站使用网盾星球提供CDN加速与防护"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-网盾星球-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://www.fomal.cc/categories/演示/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍥 小Fの案例演示笔记 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://www.fomal.cc/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/2013454f.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_14.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-06-09</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/2013454f.html&quot;);" href="javascript:void(0);" alt="">docker compose部署protail+grafana+loki+promethues</a><div class="blog-slider__text">🥧搭建一个完整的监控和日志管理系统</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/2013454f.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_14.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-08-09</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt="">Markdown语法与外挂标签写法汇总</a><div class="blog-slider__text">🥧本文汇总Markdown格式以及外挂标签在网页端的渲染效果，可作为文档进行查询</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --></body></html>